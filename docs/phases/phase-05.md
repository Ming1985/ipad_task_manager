# Phase 05: 任务执行

**类型:** ui
**状态:** completed
**相关 FR:** FR-6, FR-7

## 目标

实现任务启动、计时、进度显示，以及任务计划的序列执行。

## 涉及的 User Stories

- US-005: 开始单个任务
- US-006: 开始任务计划（序列执行）

## 任务清单

### 单个任务执行
- [x] 任务详情页面
- [x] "开始"按钮启动任务
- [x] 倒计时界面：
  - [x] 大字体剩余时间显示
  - [x] 进度环/进度条
  - [x] 任务名称和描述
- [ ] 引导打开指定 App 的提示 - 需真机测试
- [x] 暂停/继续功能
- [x] 放弃任务功能
- [x] 提前完成功能（"我已完成"按钮）

### 任务计划序列执行
- [x] 计划开始后自动启动第一个任务
- [x] 任务进度指示器（如 2/5）
- [x] 单个任务完成后自动切换
- [ ] 任务间休息时间（可选配置）- 后续优化
- [x] 计划整体进度显示
- [x] 计划完成页面（显示总积分）

### 后台计时
- [x] 后台运行时继续计时
- [x] App 切换回来时更新显示
- [x] 使用 Timer + NotificationCenter

### 任务状态管理
- [x] 创建 TaskSession 记录
- [x] 记录开始时间、结束时间
- [x] 任务中断处理（放弃）
- [x] 积分自动发放

## 验收标准
- [x] 点击"开始"按钮启动任务
- [x] 显示任务详情和倒计时
- [ ] 弹出提示引导打开指定 App - 需真机测试
- [ ] 任务期间状态栏显示剩余时间 - 后续优化
- [x] 计划执行：自动启动第一个任务，完成后自动切换
- [x] 显示当前任务进度（如 2/5）
- [x] Typecheck 通过

## 技术决策
| 决策 | 原因 |
|-----|------|
| 使用 fullScreenCover | 任务执行时全屏显示，防止误触退出 |
| Timer + NotificationCenter | 后台计时简单可靠 |
| .id(currentTaskIndex) | 强制任务切换时重新创建视图，确保状态重置 |
| 提前完成按钮 | 支持有明确目标的任务提前完成 |

## 遇到的问题
| 问题 | 解决方案 |
|-----|---------|
| 任务切换后倒计时不重置 | 添加 .id(currentTaskIndex) 强制重新创建视图 |
| iPad 上元素太小 | 增大进度环(320)、按钮(64)、字体尺寸 |

## 测试清单 (ui)

### 自动化测试
- [x] `xcodebuild build` 成功
- [ ] `xcodebuild test` UI 测试通过（如有 XCUITest）

### 手动验证
- [x] 倒计时准确
- [x] 后台切换后时间正确
- [x] 进度显示正确
- [x] 任务切换流畅
- [x] 放弃任务流程正常
- [x] 提前完成功能正常
- [ ] 横屏/竖屏适配 - 后续优化

## 实现的文件

### 新增文件
- `iPadTaskManager/Views/Child/TaskExecutionView.swift` - 任务执行视图、计划执行视图、完成页面

### 修改文件
- `iPadTaskManager/Views/Child/ChildTabView.swift` - 添加开始任务按钮连接
